<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>APAM – Flotte</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    @font-face{
      font-family:"GPMenu";
      src:url("Helvetica Neue LT Pro 93 Black Extended.otf") format("opentype");
      font-weight:900; font-style:normal;
    }
    @font-face{
      font-family:"Swiss911";
      src:url("Swiss911-ExtraCompressed.otf") format("opentype");
      font-weight:400; font-style:normal;
    }

    :root{
      --page-side-margin:60px;
      --header-height:50px;
      --header-font-size:15px;
      --header-letter-spacing:-0.05em;
      --logo-height:100px;
      --gap-logo-header:62px;
      --header-grey:#222;

      --accent:#2f6bff;

      --m-side:18px;
      --outer-x:26px;
      --gap-x:16px;
      --gap-y:16px;
      --grid-max:1460px;
    }

    *{ box-sizing:border-box; margin:0; padding:0; }
    html,body{ height:100%; }
    body{
      color:#111;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      overflow-x:hidden;
      background:#101012;
    }

    .page{ min-height:100svh; position:relative; background:#141417; }
    .content{ position:relative; z-index:2; }

    /* =============================== */
    /* MOBILE HEADER + DRAWER (unchanged minimal) */
    /* =============================== */
    .m-header{ display:none; }
    .m-overlay{ display:none; }
    .m-drawer{ display:none; }

    @media (max-width:980px){
      :root{
        --page-side-margin:var(--m-side);
        --logo-height:64px;
        --gap-logo-header:24px;
        --outer-x:18px;
        --gap-x:14px;
        --gap-y:14px;
        --grid-max:980px;
      }
      .m-header{
        display:flex;
        position:relative;
        z-index:30;
        padding:16px var(--page-side-margin) 0;
        align-items:center;
        justify-content:space-between;
      }
      .m-logo img{ height:54px; display:block; }
      .m-burger{
        width:56px; height:56px;
        background:#fff; border:0;
        border-radius:0;
        display:inline-flex;
        align-items:center;
        justify-content:center;
        cursor:pointer;
        box-shadow:0 10px 18px rgba(0,0,0,0.25);
      }
      .m-burger span{ width:22px; height:2px; background:#111; position:relative; display:block; }
      .m-burger span::before,.m-burger span::after{
        content:""; position:absolute; left:0; width:22px; height:2px; background:#111;
      }
      .m-burger span::before{ top:-7px; }
      .m-burger span::after{ top:7px; }
    }

    /* =============================== */
    /* TITLE */
    /* =============================== */
    .page-title{
      margin:22px var(--page-side-margin) 10px;
      display:flex; align-items:center; gap:14px;
    }
    .title-box{
      background:#fff;
      color:#000;
      border:1px solid rgba(0,0,0,0.12);
      box-shadow:0 18px 34px rgba(0,0,0,0.22);
      padding:18px 22px 14px;
      border-radius:0;
    }
    .title-box span{
      font-family:"Swiss911", sans-serif;
      text-transform:uppercase;
      letter-spacing:-0.02em;
      font-size:76px;
      line-height:.9;
      transform:skewX(-6deg);
      display:block;
      white-space:nowrap;
    }

    @media (max-width:980px){
      .page-title{ margin:18px var(--page-side-margin) 10px; }
      .title-box span{ font-size:56px; }
    }

    /* =============================== */
    /* GRID CARDS */
    /* =============================== */
    .fleet-wrap{
      max-width:var(--grid-max);
      margin:10px auto 34px;
      padding:0 var(--outer-x);
    }
    .fleet-grid{
      display:grid;
      grid-template-columns:repeat(2, minmax(0, 1fr));
      column-gap:var(--gap-x);
      row-gap:var(--gap-y);
    }
    .fleet-card-big{
      grid-column:1 / -1;
      max-width:calc((var(--grid-max) - (var(--outer-x) * 2) - var(--gap-x)) / 2);
      justify-self:center;
      width:100%;
    }
    @media (max-width:980px){
      .fleet-grid{ grid-template-columns:1fr; }
      .fleet-card-big{ max-width:none; justify-self:stretch; }
    }

    /* =============================== */
    /* CARD */
    /* =============================== */
    .plane-card{
      position:relative;
      border-radius:0;
      background:rgba(18,18,18,0.92);
      border:1px solid rgba(255,255,255,0.08);
      box-shadow:0 26px 60px rgba(0,0,0,0.34);
      overflow:hidden;
      text-decoration:none;
      color:#fff;
      height:410px;
      transform:translateZ(0);
      transition:transform .22s cubic-bezier(.16,1,.22,1), box-shadow .22s ease, border-color .22s ease;
    }
    .plane-card:hover{
      transform:translateY(-6px);
      border-color:rgba(47,107,255,0.35);
      box-shadow:0 30px 92px rgba(0,0,0,0.48), 0 0 0 1px rgba(47,107,255,0.16);
    }

    .card-arrow{
      position:absolute; top:16px; right:16px;
      width:48px; height:48px;
      background:#fff;
      box-shadow:0 16px 30px rgba(0,0,0,0.35);
      display:flex; align-items:center; justify-content:center;
      z-index:3;
    }
    .card-arrow i{
      width:16px; height:16px;
      border-right:4px solid #000;
      border-top:4px solid #000;
      transform:rotate(45deg);
      margin-left:-2px;
    }

    .card-top{ position:relative; z-index:2; padding:20px 20px 0; }
    .title-row{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:14px;
      padding-right:64px;
    }
    .card-name h3{
      font-family:"Swiss911", sans-serif;
      text-transform:uppercase;
      letter-spacing:-0.02em;
      font-size:38px;
      line-height:1;
      font-style:italic;
      transform:skewX(-6deg);
      white-space:nowrap;
    }

    .badges{ display:flex; gap:10px; align-items:center; }
    .badge{
      height:28px;
      padding:0 12px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-family:"GPMenu", system-ui, sans-serif;
      font-size:12px;
      letter-spacing:0.12em;
      text-transform:uppercase;
      color:#fff;
      background:rgba(0,0,0,0.35);
      border:2px solid rgba(47,107,255,0.75);
      white-space:nowrap;
    }
    .badge.ifr{ border-color:#ff3b30; }

    /* ✅ IMPORTANT: l’avion est DANS une zone, visible, pas masqué */
    .card-plane{
      position:absolute;
      left:50%;
      top:43%;
      transform:translate(-50%,-50%);
      width:min(760px, 94%);
      height:240px;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:2;
      pointer-events:none;
      overflow:visible;
    }
    .card-plane img{
      display:block;
      max-width:100%;
      max-height:100%;
      width:auto;
      height:auto;
      object-fit:contain;
      filter:drop-shadow(0 18px 22px rgba(0,0,0,0.42));
      transform:translateX(0) rotate(0deg) scale(1.18);
      transition:transform .28s cubic-bezier(.16,1,.22,1);
      will-change:transform;
    }
    /* hover */
    .plane-card:hover .card-plane img{
      transform:translateX(18px) rotate(-1.2deg) scale(1.24);
    }

    /* bandeau bas */
    .card-bottom{
      position:absolute; left:0; right:0; bottom:0;
      height:158px;
      background:linear-gradient(180deg, #2f6bff 0%, #1b45e8 100%);
      border-top:1px solid rgba(255,255,255,0.18);
      z-index:2;
      padding:16px 18px 18px;
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:18px;
      transform:translate3d(0,14px,0);
      transition:transform .22s cubic-bezier(.16,1,.22,1);
    }
    .plane-card:hover .card-bottom{ transform:translate3d(0,0,0); }

    .bottom-col h4{
      font-family:"GPMenu", system-ui, sans-serif;
      font-size:13px;
      letter-spacing:0.20em;
      text-transform:uppercase;
      margin-bottom:9px;
      opacity:.95;
    }
    .bottom-col ul{
      list-style:none;
      display:flex;
      flex-direction:column;
      gap:7px;
      font-size:16px;
      line-height:1.15;
    }
    .bottom-col li{ display:flex; gap:10px; align-items:baseline; white-space:nowrap; }
    .dot{ width:7px; height:7px; background:rgba(255,255,255,0.95); margin-top:6px; }

    /* ✅ Mobile cards: avion mieux dimensionné */
    @media (max-width:980px){
      .plane-card{ height:410px; }
      .card-plane{
        top:46%;
        width:94%;
        height:210px;
      }
      .card-plane img{
        transform:translateX(0) rotate(0deg) scale(1.02);
      }
      .plane-card:hover .card-plane img{
        transform:translateX(12px) rotate(-1deg) scale(1.05);
      }
      .card-name h3{ font-size:34px; }
      .badge{ height:26px; font-size:11px; }
      .card-bottom{ height:170px; }
    }

    /* =============================== */
    /* OVERLAY */
    /* =============================== */
    .overlay{
      position:fixed; inset:0;
      z-index:200;
      display:none;
    }
    .overlay.is-open{ display:block; }
    .overlay-backdrop{
      position:absolute; inset:0;
      background:rgba(0,0,0,0.90); /* ✅ opaque */
    }

    .overlay-panel{
      position:absolute;
      inset:24px;
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(10,10,12,0.98);
      box-shadow:0 30px 120px rgba(0,0,0,0.65);
      overflow:hidden;
    }

    /* ✅ MOBILE overlay FULLSCREEN clean + safe areas */
    @media (max-width:980px){
      .overlay-panel{
        inset:0;
        border-left:0;
        border-right:0;
        border-bottom:0;
      }
    }

    .overlay-panel::before{
      content:"";
      position:absolute; inset:0;
      background-image:
        linear-gradient(rgba(255,255,255,0.06) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.06) 1px, transparent 1px);
      background-size: 44px 44px;
      opacity:.28;
      pointer-events:none;
    }

    .overlay-inner{
      position:relative;
      z-index:2;
      height:100%;
      display:flex;
      flex-direction:column;
      min-height:0;
    }

    .overlay-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,0.10);
      background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.00));
      flex:0 0 auto;
    }

    .overlay-tabs{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      flex:1;
      min-width:0;
      overflow:auto; /* ✅ scroll horizontal si besoin */
      -webkit-overflow-scrolling:touch;
      scrollbar-width:none;
    }
    .overlay-tabs::-webkit-scrollbar{ display:none; }

    .tab-btn{
      border:1px solid rgba(255,255,255,0.16);
      background:rgba(0,0,0,0.35);
      color:#fff;
      font-family:"GPMenu", system-ui, sans-serif;
      letter-spacing:0.16em;
      text-transform:uppercase;
      font-size:12px;
      padding:12px 18px;
      cursor:pointer;
      min-width:180px;
      white-space:nowrap;
    }
    .tab-btn.is-active{
      background:rgba(47,107,255,0.78);
      border-color:rgba(47,107,255,0.85);
      box-shadow:0 0 0 1px rgba(47,107,255,0.20), 0 18px 40px rgba(0,0,0,0.35);
    }

    @media (max-width:980px){
      .tab-btn{ min-width:auto; padding:12px 12px; }
    }

    .apam-btn{
      border:1px solid rgba(255,255,255,0.16);
      background:rgba(0,0,0,0.35);
      color:#fff;
      font-family:"GPMenu", system-ui, sans-serif;
      letter-spacing:0.18em;
      text-transform:uppercase;
      font-size:12px;
      padding:10px 12px;
      cursor:pointer;
    }

    .close-x{
      width:56px; height:56px;
      background:#fff;
      border:0;
      cursor:pointer;
      box-shadow:0 10px 18px rgba(0,0,0,0.35);
      position:relative;
      flex:0 0 auto;
    }
    .close-x::before,.close-x::after{
      content:"";
      width:24px; height:2px;
      background:#111;
      position:absolute;
      left:50%; top:50%;
    }
    .close-x::before{ transform:translate(-50%,-50%) rotate(45deg); }
    .close-x::after{ transform:translate(-50%,-50%) rotate(-45deg); }

    .overlay-body{
      flex:1 1 auto;
      min-height:0;
      padding:18px;
      overflow:auto; /* ✅ scroll interne */
      -webkit-overflow-scrolling:touch;
    }

    .aircraft-name{
      font-family:"Swiss911", sans-serif;
      text-transform:uppercase;
      letter-spacing:-0.02em;
      font-size:84px;
      line-height:.88;
      font-style:italic;
      transform:skewX(-6deg);
      color:#fff;
      margin:12px 0 14px;
    }
    @media (max-width:980px){
      .aircraft-name{ font-size:56px; }
    }

    .pageview{ display:none; }
    .pageview.is-active{ display:block; }

    /* fiche layout */
    .fiche-layout{
      display:grid;
      grid-template-rows: 320px 1fr;
      gap:18px;
      min-height:0;
    }
    @media (max-width:980px){
      .fiche-layout{ grid-template-rows: 260px auto; }
    }

    .stage{
      position:relative;
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(0,0,0,0.35);
      overflow:hidden;
    }
    .stage-plane{
      position:absolute;
      left:50%; top:54%;
      transform:translate(-50%,-50%);
      width:min(820px, 92%);
      height:240px;
      display:flex;
      align-items:center;
      justify-content:center;
      pointer-events:none;
    }
    .stage-plane img{
      max-width:100%;
      max-height:100%;
      object-fit:contain;
      filter:drop-shadow(0 18px 26px rgba(0,0,0,0.55));
    }

    /* callouts sans traits */
    .callout{
      position:absolute;
      width:260px;
      border:1px solid rgba(47,107,255,0.55);
      background:rgba(0,0,0,0.48);
      padding:14px 14px 12px;
      color:#fff;
      box-shadow:0 14px 34px rgba(0,0,0,0.35);
    }
    .callout .label{
      font-family:"GPMenu", system-ui, sans-serif;
      letter-spacing:0.18em;
      text-transform:uppercase;
      font-size:12px;
      opacity:.88;
      margin-bottom:6px;
    }
    .callout .value{
      font-family:"Swiss911", sans-serif;
      text-transform:uppercase;
      font-size:34px;
      line-height:0.95;
      letter-spacing:-0.02em;
      font-style:italic;
      transform:skewX(-6deg);
      margin-bottom:6px;
    }
    .callout .desc{
      font-size:13px;
      color:rgba(255,255,255,0.75);
    }

    /* ✅ MOBILE: callouts passent en mode “stack” en bas si ça déborde */
    @media (max-width:980px){
      .callout{
        width:auto;
        left:12px !important;
        right:12px !important;
        top:auto !important;
        bottom:12px !important;
        position:absolute;
      }
      /* on affiche seulement le 1er callout (sinon c’est illisible) */
      #callouts .callout:not(:first-child){ display:none; }
    }

    /* specs table */
    .specs{
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(0,0,0,0.35);
      overflow:hidden;
    }
    .specs-table{ width:100%; border-collapse:collapse; }
    .specs-table tr{ border-bottom:1px dashed rgba(255,255,255,0.10); }
    .specs-table td{ padding:12px 14px; font-size:14px; color:rgba(255,255,255,0.80); }
    .specs-table td.val{
      text-align:right;
      font-family:"Swiss911", sans-serif;
      text-transform:uppercase;
      font-size:20px;
      font-style:italic;
      transform:skewX(-6deg);
      color:#fff;
      white-space:nowrap;
    }

    /* debug placeholder si image cassée */
    .img-fallback{
      font-family:"GPMenu", system-ui, sans-serif;
      font-size:12px;
      letter-spacing:0.14em;
      text-transform:uppercase;
      color:rgba(255,255,255,0.70);
      border:1px dashed rgba(255,255,255,0.18);
      padding:10px 12px;
      background:rgba(0,0,0,0.25);
    }
  </style>
</head>

<body>
  <div class="page">
    <div class="content">

      <!-- Mobile header -->
      <div class="m-header">
        <a class="m-logo" href="index.html" aria-label="Retour accueil">
          <img src="./images/apam-logo1.png" alt="Logo APAM">
        </a>
        <button class="m-burger" type="button" aria-label="Menu"><span></span></button>
      </div>

      <div class="page-title">
        <div class="title-box"><span>FLOTTE</span></div>
      </div>

      <main class="fleet-wrap">
        <section class="fleet-grid">

          <!-- C152 -->
          <a class="plane-card js-open-overlay" href="#" data-aircraft="c152" aria-label="Cessna 152">
            <div class="card-arrow" aria-hidden="true"><i></i></div>

            <div class="card-top">
              <div class="title-row">
                <div class="card-name"><h3>CESSNA 152</h3></div>
                <div class="badges"><span class="badge">VFR</span></div>
              </div>
            </div>

            <div class="card-plane">
              <img src="FGHK2.png" alt="Cessna 152" loading="eager">
            </div>

            <div class="card-bottom">
              <div class="bottom-col">
                <h4>SPECS</h4>
                <ul>
                  <li><span class="dot"></span><span>Places : 2</span></li>
                  <li><span class="dot"></span><span>Aile : Haute</span></li>
                  <li><span class="dot"></span><span>Train : Classique</span></li>
                </ul>
              </div>
              <div class="bottom-col">
                <h4>TARIFS</h4>
                <ul>
                  <li><span class="dot"></span><span>Brevetés : — €/h</span></li>
                  <li><span class="dot"></span><span>Non-brevetés : — €/h</span></li>
                  <li><span class="dot"></span><span>Instruction : — €/h</span></li>
                </ul>
              </div>
            </div>
          </a>

          <!-- TB200 -->
          <a class="plane-card js-open-overlay" href="#" data-aircraft="tb200" aria-label="TB200">
            <div class="card-arrow" aria-hidden="true"><i></i></div>

            <div class="card-top">
              <div class="title-row">
                <div class="card-name"><h3>TB200</h3></div>
                <div class="badges"><span class="badge">VFR</span></div>
              </div>
            </div>

            <div class="card-plane">
              <img src="./images/TB200M.png" alt="TB200" loading="lazy">
            </div>

            <div class="card-bottom">
              <div class="bottom-col">
                <h4>SPECS</h4>
                <ul>
                  <li><span class="dot"></span><span>Places : —</span></li>
                  <li><span class="dot"></span><span>Vitesse : —</span></li>
                  <li><span class="dot"></span><span>Autonomie : —</span></li>
                </ul>
              </div>
              <div class="bottom-col">
                <h4>TARIFS</h4>
                <ul>
                  <li><span class="dot"></span><span>Brevetés : — €/h</span></li>
                  <li><span class="dot"></span><span>Non-brevetés : — €/h</span></li>
                  <li><span class="dot"></span><span>Instruction : — €/h</span></li>
                </ul>
              </div>
            </div>
          </a>

          <!-- SR22 -->
          <a class="plane-card fleet-card-big js-open-overlay" href="#" data-aircraft="sr22" aria-label="Cirrus SR22">
            <div class="card-arrow" aria-hidden="true"><i></i></div>

            <div class="card-top">
              <div class="title-row">
                <div class="card-name"><h3>CIRRUS SR22</h3></div>
                <div class="badges">
                  <span class="badge">VFR</span>
                  <span class="badge ifr">IFR</span>
                </div>
              </div>
            </div>

            <div class="card-plane">
              <img src="./images/SR1.png" alt="Cirrus SR22" loading="lazy">
            </div>

            <div class="card-bottom">
              <div class="bottom-col">
                <h4>SPECS</h4>
                <ul>
                  <li><span class="dot"></span><span>Places : —</span></li>
                  <li><span class="dot"></span><span>Avionique : —</span></li>
                  <li><span class="dot"></span><span>IFR : Oui</span></li>
                </ul>
              </div>
              <div class="bottom-col">
                <h4>TARIFS</h4>
                <ul>
                  <li><span class="dot"></span><span>Brevetés : — €/h</span></li>
                  <li><span class="dot"></span><span>Non-brevetés : — €/h</span></li>
                  <li><span class="dot"></span><span>Instruction : — €/h</span></li>
                </ul>
              </div>
            </div>
          </a>

        </section>
      </main>

      <!-- OVERLAY -->
      <div class="overlay" id="overlay" aria-hidden="true">
        <div class="overlay-backdrop" data-close></div>

        <div class="overlay-panel" role="dialog" aria-modal="true" aria-label="Fiche avion">
          <div class="overlay-inner">

            <div class="overlay-top">
              <button class="apam-btn" id="btn-apam" type="button">APAM</button>

              <div class="overlay-tabs" role="tablist">
                <button class="tab-btn is-active" data-tab="fiche" type="button">FICHE TECHNIQUE</button>
                <button class="tab-btn" data-tab="tarifs" type="button">VOIR LES TARIFS</button>
                <button class="tab-btn" data-tab="contact" type="button">CONTACT</button>
              </div>

              <button class="close-x" type="button" aria-label="Fermer" data-close></button>
            </div>

            <div class="overlay-body">
              <div class="aircraft-name" id="overlay-name">CESSNA 152</div>

              <div class="pageview is-active" data-view="fiche">
                <div class="fiche-layout">
                  <div class="stage">
                    <div class="stage-plane">
                      <img id="stage-img" src="./images/FGHK2.png" alt="Cessna 152">
                    </div>
                    <div id="callouts"></div>
                  </div>

                  <div class="specs">
                    <table class="specs-table" id="specs-table"></table>
                  </div>
                </div>
              </div>

              <div class="pageview" data-view="tarifs">
                <div class="img-fallback">Tarifs : à intégrer ici (même style que specs)</div>
              </div>

              <div class="pageview" data-view="contact">
                <div class="img-fallback">Contact : formulaire mailto à intégrer ici</div>
              </div>

            </div>

          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    /* ✅ Chemins d’images centralisés (évite les erreurs) */
    const IMG_BASE = "./images/";

    const AIRCRAFT = {
      c152: {
        name: "CESSNA 152",
        img: "FGHK2.png",
        callouts: [
          { label:"COCKPIT", value:"ANALOGIQUE", desc:"Instruments classiques", x: 6,  y: 24 },
          { label:"TRAIN",   value:"CLASSIQUE",  desc:"Maniabilité / école",  x: 6,  y: 58 },
          { label:"AILE",    value:"HAUTE",      desc:"Stabilité / visibilité", x: 68, y: 40 }
        ],
        specs: [
          ["Places", "2"],
          ["Aile", "Haute"],
          ["Train", "Classique"],
          ["Avionique", "Analogique"],
          ["Vol de nuit", "Non"],
          ["IFR", "Non"],
          ["Autonomie", "4h"],
          ["Croisière", "90 KTS"]
        ]
      },
      tb200: {
        name: "TB200",
        img: "TB200M.png",
        callouts: [
          { label:"COCKPIT", value:"MIXTE", desc:"École / performance", x: 6,  y: 24 },
          { label:"TRAIN",   value:"TRICYCLE", desc:"Facile & stable",  x: 6,  y: 58 },
          { label:"PROFIL",  value:"VOYAGE", desc:"Confort / vitesse",  x: 68, y: 40 }
        ],
        specs: [
          ["Places", "—"],
          ["Vol de nuit", "—"],
          ["IFR", "Non"],
          ["Autonomie", "—"],
          ["Croisière", "—"]
        ]
      },
      sr22: {
        name: "CIRRUS SR22",
        img: "SR1.png",
        callouts: [
          { label:"COCKPIT", value:"GLASS", desc:"Avionique moderne", x: 6,  y: 24 },
          { label:"SÉCURITÉ", value:"CAPS", desc:"Parachute cellule", x: 6, y: 58 },
          { label:"IFR", value:"ÉQUIPÉ", desc:"Voyage / navigation", x: 68, y: 40 }
        ],
        specs: [
          ["CAPS", "Oui"],
          ["Vol de nuit", "Oui"],
          ["IFR", "Oui"],
          ["Autonomie", "—"],
          ["Croisière", "—"]
        ]
      }
    };

    /* ✅ Debug: si l’image ne charge pas, on affiche le chemin cassé */
    function attachImageDebug(imgEl){
      imgEl.addEventListener("error", () => {
        const p = imgEl.parentElement;
        if(!p) return;
        p.innerHTML = `<div class="img-fallback">IMG NOT FOUND:<br>${imgEl.getAttribute("src")}</div>`;
      }, { once:true });
    }

    document.querySelectorAll(".card-plane img").forEach(attachImageDebug);

    /* OVERLAY */
    const overlay = document.getElementById('overlay');
    const overlayName = document.getElementById('overlay-name');
    const stageImg = document.getElementById('stage-img');
    const calloutsWrap = document.getElementById('callouts');
    const specsTable = document.getElementById('specs-table');

    function renderCallouts(items){
      calloutsWrap.innerHTML = "";
      (items || []).forEach(c => {
        const el = document.createElement("div");
        el.className = "callout";
        el.style.left = c.x + "%";
        el.style.top  = c.y + "%";
        el.innerHTML = `
          <div class="label">${c.label}</div>
          <div class="value">${c.value}</div>
          <div class="desc">${c.desc || ""}</div>
        `;
        calloutsWrap.appendChild(el);
      });
    }

    function renderSpecs(rows){
      specsTable.innerHTML = "";
      (rows || []).forEach(([k,v]) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${k}</td><td class="val">${v}</td>`;
        specsTable.appendChild(tr);
      });
    }

    function loadAircraft(key){
      const a = AIRCRAFT[key] || AIRCRAFT.c152;
      overlayName.textContent = a.name;

      const full = IMG_BASE + a.img;
      stageImg.src = full;
      stageImg.alt = a.name;
      attachImageDebug(stageImg);

      renderCallouts(a.callouts);
      renderSpecs(a.specs);
    }

    function openOverlay(key){
      loadAircraft(key);
      overlay.classList.add('is-open');
      overlay.setAttribute('aria-hidden','false');
      document.body.style.overflow = "hidden";
      setTab("fiche");
    }
    function closeOverlay(){
      overlay.classList.remove('is-open');
      overlay.setAttribute('aria-hidden','true');
      document.body.style.overflow = "";
    }

    document.querySelectorAll('.js-open-overlay').forEach(card => {
      card.addEventListener('click', (e) => {
        e.preventDefault();
        openOverlay(card.getAttribute('data-aircraft') || "c152");
      });
    });

    overlay.querySelectorAll('[data-close]').forEach(el => el.addEventListener('click', closeOverlay));
    document.addEventListener('keydown', (e) => { if(e.key === 'Escape' && overlay.classList.contains('is-open')) closeOverlay(); });
    document.getElementById('btn-apam').addEventListener('click', closeOverlay);

    /* Tabs */
    const tabBtns = Array.from(document.querySelectorAll('.tab-btn'));
    const views = Array.from(document.querySelectorAll('.pageview'));
    function setTab(tab){
      tabBtns.forEach(b => b.classList.toggle('is-active', b.getAttribute('data-tab') === tab));
      views.forEach(v => v.classList.toggle('is-active', v.getAttribute('data-view') === tab));
    }
    tabBtns.forEach(btn => btn.addEventListener('click', () => setTab(btn.getAttribute('data-tab'))));
  </script>
</body>
</html>
